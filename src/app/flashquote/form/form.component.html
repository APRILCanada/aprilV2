<div class="wrapper flash-form" *ngIf="formState$ | async as formState">
  {{ quoteResult?.total?.premium }} $
  <!-- <div class="d-flex align-items-start">
    <img src="../../../../assets/img/icons/title-bar.svg" class="pt-2 pe-2 title-bar d-none d-sm-block"
      alt="title bar" />
    <h3 class="mb-2">{{ "GET_QUOTE" | translate }}</h3>
  </div> -->

  <!-- DYNAMIC FORM -->
  <!-- <form *ngIf="!submittingForm" [ngrxFormState]="formState" (submit)="submit()"> -->
  <form [ngrxFormState]="formState" (submit)="submit()">

    <app-section [progress]="progress" [formValid$]="formValid$" [formSubmitted$]="formSubmitted$">
      <div *ngIf="activeSection.id && !activeSection.isPrime">
        <div *ngFor="let group of formState.controls[activeSection.id].controls; let i = index; trackBy:customTrackBy">
          <header class="groupSection-header" *ngIf="activeSection.isRepeat">
            <h2>{{ language.get() == "fr" ? activeSection.title.LabelFr.slice(0, -1) :
              activeSection.title.LabelEn.slice(0, -1) }} {{ i + 1 }}</h2>
            <button type="button"
              class="button-icon-small button-red d-flex align-items-center justify-content-center text-button-simple"
              (click)="removeGroupSection(activeSection.id, i)" *ngIf="i > 0">
              <mat-icon
                style="color:#ee3629; font-size:20px !important; width:20px !important; height:20px !important;">clear
              </mat-icon>
            </button>
          </header>

          <ng-container *ngFor="let question of questionsBySection; let j = index; trackBy:customTrackByTwo">
            <div *ngIf="formState.controls[activeSection.id].controls[i].controls[question.id]">
              <!-- QUESTION BASE -->
              <app-question-base [question]="question"
                [control]="formState.controls[activeSection.id].controls[i].controls[question.id]"
                [error]="(errors$ | async)['_' + activeSection.id] && (errors$ | async)['_' + activeSection.id]['_' + i] && (errors$ | async)['_' + activeSection.id]['_' + i]['_' + question.id]">

                <app-error [control]="formState.controls[activeSection.id].controls[i].controls[question.id]"
                  [error]="(errors$ | async)['_' + activeSection.id] && (errors$ | async)['_' + activeSection.id]['_' + i] && (errors$ | async)['_' + activeSection.id]['_' + i]['_' + question.id]">
                </app-error>
              </app-question-base>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- PRIME -->
      <section *ngIf="activeSection.id && activeSection.isPrime">
        <div class="prime-box">
          <p class="prime-box__prime">{{ quoteResult?.total?.premium }} $</p>
          <small class="year">({{ "YEAR_TAXES" | translate }})</small>
        </div>

        <div class="call">
          <p>{{ "CONTACT_AGENT" | translate }}</p>
          <a class="btn-phone" href="tel: {{broker.phone}}">{{ broker.phone }}</a>
          <small class="hours">
            <span *ngFor="let line of broker.openingHours[lang]">{{ line }}</span>
          </small>
        </div>

        <div>
          <svg class="exclaim" width="24" height="79" viewBox="0 0 24 79" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M18.6667 53.1933H5.33333L0 0H24L18.6667 53.1933Z" fill="#A6AEB0" />
            <path
              d="M12 79C17.6701 79 22.2667 74.5199 22.2667 68.9933C22.2667 63.4668 17.6701 58.9867 12 58.9867C6.32988 58.9867 1.73333 63.4668 1.73333 68.9933C1.73333 74.5199 6.32988 79 12 79Z"
              fill="#A6AEB0" />
          </svg>

          <p class="more-info">{{ "ESTIMATION" | translate }}</p>
        </div>
      </section>
    </app-section>

    <div *ngIf="!activeSection.isPrime" class="section-buttons">
      <!-- PREVIOUS -->
      <button type="button" *ngIf="!activeSection.isFirst" class="btn-april" (click)="setActiveSection(-1)">
        {{ "BACK" | translate }}
      </button>

      <!-- NEXT -->
      <button type="button" *ngIf="!activeSection.isLast" class="btn-april next" (click)="setActiveSection(1)">
        {{ "NEXT" | translate }}
      </button>

      <!-- SUBMIT -->
      <button *ngIf="activeSection.isLast" class="btn-april" type="submit" data-analytics="DirectForm"
        [disabled]="!(formValid$ | async) && (formSubmitted$ | async)">
        {{ "SUBMIT_QUOTE" | translate }}
      </button>
    </div>

  </form>

</div>