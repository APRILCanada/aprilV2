<div class="wrapper flash-form" *ngIf="formState$ | async as formState">

  <!-- <div class="d-flex align-items-start">
    <img src="../../../../assets/img/icons/title-bar.svg" class="pt-2 pe-2 title-bar d-none d-sm-block"
      alt="title bar" />
    <h3 class="mb-2">{{ "GET_QUOTE" | translate }}</h3>
  </div> -->

  <!-- DYNAMIC FORM -->
  <!-- <form *ngIf="!submittingForm" [ngrxFormState]="formState" (submit)="submit()"> -->
  <form *ngIf="!submittingForm" [ngrxFormState]="formState" (submit)="submit()">

    <app-section [progress]="progress" [formValid$]="formValid$" [formSubmitted$]="formSubmitted$">

      <div *ngIf="activeSection.id">
        <div *ngFor="let group of formState.controls[activeSection.id].controls; let i = index; trackBy:customTrackBy">
          <header class="groupSection-header" *ngIf="activeSection.isRepeat">
            <h2>{{ activeSection.title.LabelEn }} {{ i + 1 }}</h2>
            <button type="button"
              class="button-icon-small button-red d-flex align-items-center justify-content-center text-button-simple"
              (click)="removeGroupSection(activeSection.id, i)" *ngIf="i > 0">
              <mat-icon
                style="color:#ee3629; font-size:20px !important; width:20px !important; height:20px !important;">clear
              </mat-icon>
            </button>
          </header>
          <ng-container *ngFor="let question of questionsBySection; let j = index; trackBy:customTrackByTwo">

            <div *ngIf="formState.controls[activeSection.id].controls[i].controls[question.id]">
              <!-- QUESTION BASE -->
              <app-question-base [question]="question"
                [control]="formState.controls[activeSection.id].controls[i].controls[question.id]"
                [error]="(errors$ | async)['_' + activeSection.id] && (errors$ | async)['_' + activeSection.id]['_' + i] && (errors$ | async)['_' + activeSection.id]['_' + i]['_' + question.id]">

                <app-error [control]="formState.controls[activeSection.id].controls[i].controls[question.id]"
                  [error]="(errors$ | async)['_' + activeSection.id] && (errors$ | async)['_' + activeSection.id]['_' + i] && (errors$ | async)['_' + activeSection.id]['_' + i]['_' + question.id]">
                </app-error>
              </app-question-base>
            </div>

          </ng-container>
        </div>
      </div>
    </app-section>

    <div class="section-buttons">
      <!-- PREVIOUS -->
      <button type="button" *ngIf="!activeSection.isFirst" class="btn-april" (click)="setActiveSection(-1)">
        Previous
      </button>

      <!-- NEXT -->
      <button type="button" *ngIf="!activeSection.isLast" class="btn-april next" (click)="setActiveSection(1)">
        Next
      </button>

      <!-- SUBMIT -->
      <button *ngIf="activeSection.isLast" class="btn-april" type="submit" data-analytics="DirectForm"
        [disabled]="!(formValid$ | async) && (formSubmitted$ | async)">
        {{ "SEND" | translate }}
      </button>
    </div>

  </form>

</div>